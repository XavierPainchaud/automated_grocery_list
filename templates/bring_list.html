<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Votre liste d'épicerie</title>
    <script async="async" src="//platform.getbring.com/widgets/import.js"></script>
</head>
<body>
    <h1>Votre liste d'épicerie pour Bring!</h1>
    <ul>
        {% for item in shopping_list %}
        <li>{{ item }}</li>  <!-- Display the item name -->
        {% endfor %}
    </ul>
    
    <!-- Bring Import Widget -->
    <div data-bring-import data-bring-language="en">
        <a href="https://www.getbring.com">Importer dans Bring!</a>
    </div>
    
    <script>
        // Dynamically inject the shopping list into the Bring widget
        const bringWidget = document.querySelector('[data-bring-import]');
        
        // Log the bringWidget to ensure it's selected correctly
        console.log("bringWidget:", bringWidget);
        
        const shoppingList = {{ shopping_list|tojson }};  // Render the list as JSON
        
        // Log shoppingList to check if it's correctly injected from Python
        console.log("shoppingList:", shoppingList);
        
        // Format the shopping list for the Bring widget
        const formattedList = {
            ingredients: shoppingList
        };
        
        // Log formattedList to ensure it's formatted correctly
        console.log("formattedList:", formattedList);

        //const attributs = JSON.stringify(formattedList);


        const attributs = {
            "author": "Author Name",
            "linkOutUrl": "https://www.myrecipe.com",
            "imageUrl": "https://www.myrecipe.com/recipeImage.jpg",
            "name": "Hummus mit Rüebli",
            "tagline": "",
            "yield": "",
            "time": "",
            "nutrition": {
            "calories": "500 kcal"
            },
            "items": [{
            "itemId": "Karotten",
            "spec": "2-3"
            }, {
            "itemId": "Sumach",
            "spec": "1/4 TL",
            "altIcon": "Rosmarin",
            "altSection": "Früchte & Gemüse"
            }, {
            "itemId": "Salz",
            "stock": true
            }]
            };

        // Log the final list data
        console.log("attributs:", attributs);


        // Set the 'data-bring-items' attribute for the Bring widget
        bringWidget.setAttribute('data-bring-items', attributs);
        bringWidget.setAttribute('data-bring-import', attributs);
    </script> 
</body>
</html>
